<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-ajax/iron-ajax.html">
<link rel="import" href="../../iron-list/iron-list.html">

<dom-module id="congress-member">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        border: 2px solid #889daa;
      }

      figure {
        margin: 0;
        display: inline-block;
        vertical-align: top;
      }

      figcaption {
        display: block;
      }

      .rolecard {
        display: inline-block;
      }
    </style>
    <iron-ajax
      id = "ajax"
      url=""
      handle-as"json"
      on-response="responseHandler"
      debounce-duration="300">
    </iron-ajax>
    <template is="dom-repeat" items={{data}}>
    <div class="item">
      <figure>
        <img src="{{image}}" alt="">
        <figcaption><p>{{item.first_name}} {{item.last_name}}</p></figcaption>
      </figure>
      <section>
        <iron-list items="{{item.roles}}" as="role">
          <template>
            <div class="role">
              <p>{{role.title}}</p>
              <p>{{role.chamber}}</p>
              <p>{{role.state}}</p>
              <p>{{role.party}}</p>
              <p>{{role.start_date}} - {{role.end_date}}</p>
          </div>
          </template>
        </iron-list>
      </section>
    </div>
    </template>
  </template>
</dom-module>
<script>
(function() {
  Polymer({
    is: 'congress-member',
    ready: function() {
      this._setAjax();
      this.image = "https://www.congress.gov/img/member/" + key.toLowerCase() + ".jpg";
    },
    _setAjax: function() {
      this.$.ajax.url = "https://api.propublica.org/congress/v1/members/"+ this.key + ".json";
      this.$.ajax.headers = {"X-API-KEY": process.env.congress};
      this.$.ajax.sync = true;
      this.$.ajax.generateRequest();
    },
    responseHandler: function(request) {
      data = JSON.parse(request.detail.response).results;
      return this.data = data;
    },
    properties: {
      key: String,
    },
    created: function() {
      key = this.getAttribute('key');
    },
    observers: [
      'logFor(data)',
    ],
    logFor: function(thing) {
      console.log(thing)
    }
  });
Polymer.log = console.log.bind(console);
})();
</script>

